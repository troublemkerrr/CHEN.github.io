<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Claire&#39;s Space</title>
  
  
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2023-05-12T14:10:12.707Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>Claire</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>CMU15-445ï¼ˆFALL 2022ï¼‰Project 2</title>
    <link href="http://example.com/2023/05/10/p2/"/>
    <id>http://example.com/2023/05/10/p2/</id>
    <published>2023-05-10T12:43:49.018Z</published>
    <updated>2023-05-12T14:10:12.707Z</updated>
    
    <content type="html"><![CDATA[<p>åªè®°å½•è‡ªå·±åœ¨å®ç°è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ï¼Œæ‰€ä»¥å†™å¾—ä¸å¤Ÿè¯¦å°½ï¼ˆå½“ç„¶ä¹Ÿä¸ä¼šå…¬å¼€å®Œæ•´ä»£ç </p><h2 id="B-æ ‘èŠ‚ç‚¹"><a href="#B-æ ‘èŠ‚ç‚¹" class="headerlink" title="B+æ ‘èŠ‚ç‚¹"></a>B+æ ‘èŠ‚ç‚¹</h2><p>b+æ ‘ä¸­æœ‰ä¸¤ç§èŠ‚ç‚¹ï¼šå†…éƒ¨èŠ‚ç‚¹ï¼ˆInternalPageï¼‰å’Œå¶å­èŠ‚ç‚¹ï¼ˆLeafPageï¼‰ï¼Œè¿™ä¸¤ç§èŠ‚ç‚¹éƒ½ç»§æ‰¿è‡ª BPlusTreePageã€‚å†…éƒ¨èŠ‚ç‚¹ä¸ä¿å­˜è®°å½•ï¼Œåªç”¨äºç´¢å¼•ï¼Œæ‰€æœ‰è®°å½•éƒ½ä¿å­˜åœ¨å¶å­èŠ‚ç‚¹ä¸­ã€‚è¿™ä¸¤ç§èŠ‚ç‚¹éƒ½ä¸æ˜¯ç›´æ¥åˆ›å»ºçš„ï¼Œè€Œæ˜¯ç”± BufferPool ç®¡ç†çš„ Page çš„ dataéƒ¨åˆ†å¼ºåˆ¶è½¬åŒ–è€Œæ¥ã€‚å› æ­¤b+æ ‘èŠ‚ç‚¹çš„page_id_ä¸ä»…æ˜¯æ ‘ä¸­èŠ‚ç‚¹çš„ç¼–å·ï¼Œä¹Ÿæ˜¯è¿™ä¸ªèŠ‚ç‚¹ä½¿ç”¨çš„ Page åœ¨ BufferPool ä¸­çš„ç¼–å·ã€‚</p><p>ä¸¤ç§èŠ‚ç‚¹éƒ½æœ‰è¿™ä¸ªæˆå‘˜å˜é‡ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MappingType std::pair<span class="meta-string">&lt;KeyType, ValueType&gt;</span></span></span><br><span class="line">MappingType array_[<span class="number">1</span>]; <span class="comment">// æŸ”æ€§æ•°ç»„</span></span><br></pre></td></tr></table></figure><p>èŠ‚ç‚¹å†…çš„æ•°æ®ç”¨array_æ¥å­˜å‚¨ã€‚æ•°æ®éƒ½æ˜¯é”®å€¼å¯¹ï¼ŒInternalPageçš„é”®å€¼å¯¹æ˜¯ key â€” page_idï¼ˆç”¨äºæŸ¥æ‰¾åˆ°å­èŠ‚ç‚¹ï¼Œå¯èƒ½æ˜¯InternalPageæˆ–LeafPageï¼‰ï¼ŒLeafPageçš„é”®å€¼å¯¹æ˜¯ key â€” RIDï¼ˆç”¨äºæ ‡è¯†ä¸€ä¸ªtupleï¼Œtupleå¯¹åº”æ•°æ®åº“è¡¨ä¸­çš„ä¸€è¡Œæ•°æ®ï¼‰ã€‚</p><img src="https://s2.loli.net/2023/05/09/CGXjHlzTYsnAkvI.jpg" alt="array_ç¤ºæ„å›¾" style="zoom: 25%;" /><p>ä¸¤ç§ç­‰æ•ˆçš„ä½¿ç”¨æ–¹æ³•ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">*(array_ + idx) = &#123;key, value&#125;;</span><br><span class="line"></span><br><span class="line">array_[idx].first = key;</span><br><span class="line">array_[idx].second = value;</span><br></pre></td></tr></table></figure><p>è¿™å‡ ç§èŠ‚ç‚¹éƒ½ä¸éš¾å®ç°ï¼Œé‡ç‚¹æ˜¯è¦æ ¹æ®æ‰€éœ€æ·»åŠ è‡ªå®šä¹‰æˆå‘˜æ–¹æ³•ã€‚</p><p>æµ…è°ˆ<strong>éƒ¨åˆ†æ–°å¢çš„æˆå‘˜æ–¹æ³•</strong>ï¼š</p><ul><li><p>Splitï¼šLeafPage åˆ†è£‚æ—¶éœ€è¦ç»´æŠ¤ next_page_id_ï¼Œè€Œ InternalPage åˆ†è£‚æ—¶éœ€è¦æ›´æ”¹ä¸‹æ–¹å­èŠ‚ç‚¹çš„ parent_page_id_ï¼ŒMergeç±»ä¼¼</p></li><li><p>ä¸º InternalPage å†™äº†ä¸¤ä¸ªæ’å…¥æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯æ’å…¥åˆ°æŒ‡å®šç´¢å¼•å¤„ï¼Œä¸€ä¸ªæ˜¯å…ˆæ‰¾åˆ°æŒ‡å®šå­èŠ‚ç‚¹çš„ä½ç½®ï¼Œç„¶åæ’å…¥åœ¨å…¶åã€‚ä¼šç”¨åˆ° std::move_backward() æ–¹æ³•</p></li><li><p>Removeï¼šå¦‚æœè¦åˆ é™¤ä¸­é—´çš„æ•°æ®ï¼Œå°±æŠŠåé¢çš„æ•°æ®éƒ½å¾€å‰ç§»è¦†ç›–æ‰å®ƒï¼›å¦‚æœåˆ é™¤æœ«å°¾çš„æ•°æ®ï¼Œç›´æ¥æŠŠèŠ‚ç‚¹çš„å¤§å°-1å³å¯ã€‚å¯ä»¥ç”¨ std::move() æˆ– std::copy() å¸®åŠ©å®ç°</p></li><li><p>æŸ¥æ‰¾keyçš„ç´¢å¼•ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ³¨æ„std::lower_bound()å’Œstd::distance()</span></span><br><span class="line"><span class="function">INDEX_TEMPLATE_ARGUMENTS</span></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">B_PLUS_TREE_LEAF_PAGE_TYPE::KeyIndex</span><span class="params">(<span class="keyword">const</span> KeyType &amp;key, <span class="keyword">const</span> KeyComparator &amp;keyComparator)</span> <span class="keyword">const</span> -&gt; <span class="keyword">int</span> </span>&#123;</span><br><span class="line">  <span class="keyword">auto</span> target = std::<span class="built_in">lower_bound</span>(array_, array_ + <span class="built_in">GetSize</span>(), key, [&amp;keyComparator](<span class="keyword">const</span> <span class="keyword">auto</span> &amp;pair, <span class="keyword">auto</span> k) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">keyComparator</span>(pair.first, k) &lt; <span class="number">0</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> std::<span class="built_in">distance</span>(array_, target);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><hr><h2 id="B-æ ‘æ•°æ®ç»“æ„"><a href="#B-æ ‘æ•°æ®ç»“æ„" class="headerlink" title="B+æ ‘æ•°æ®ç»“æ„"></a>B+æ ‘æ•°æ®ç»“æ„</h2><p><img src="https://s2.loli.net/2023/05/09/X7EwZBONlyScDrj.png" alt="b+æ ‘ç¤ºä¾‹"></p><p>å›¾ä¸­è¿™é¢—b+æ ‘çš„ leaf_max_size_ = internal_max_size_ = 3ã€‚</p><p><strong>ä¸€äº›è§„åˆ™ï¼š</strong></p><ul><li><p>è§„å®šæ ¹èŠ‚ç‚¹çš„ parent_page_id_ ä¸º INVALID_PAGE_ID ã€‚è‹¥æ ‘ä¸ºç©ºï¼Œroot_page_id_ = INVALID_PAGE_IDã€‚</p></li><li><p>KeyComparator çš„æ¯”è¾ƒè§„åˆ™æ˜¯ï¼šå·¦&lt;å³æ—¶è¿”å›-1ï¼Œå·¦&gt;å³æ—¶è¿”å›1ï¼Œç›¸ç­‰è¿”å›0ã€‚</p></li><li><p>å¶å­èŠ‚ç‚¹çš„min_size = leaf_max_size_ / 2ï¼Œå†…éƒ¨èŠ‚ç‚¹çš„min_size = (internal_max_size_ + 1) / 2ã€‚å¶å­èŠ‚ç‚¹åœ¨æ’å…¥ååˆ¤æ–­æ˜¯å¦æ»¡ï¼ˆæ‰€ä»¥å¶å­èŠ‚ç‚¹æœ€å¤šå­˜ max_size_-1 çš„æ•°æ®ï¼‰ï¼Œå†…éƒ¨èŠ‚ç‚¹åœ¨æ’å…¥å‰åˆ¤æ–­ï¼Œè‹¥æ»¡ï¼Œåˆ™åˆ†è£‚ã€‚</p></li><li><p>è‹¥èŠ‚ç‚¹å¤§å° &lt; min_sizeï¼Œéœ€è¦åˆå¹¶æˆ–é‡æ–°åˆ†é…ã€‚</p></li><li><p>å–ä¸€ä¸ªé¡µé¢ï¼Œç”¨ FetchPageï¼Œç„¶åå¼ºè½¬ä¸ºB+æ ‘èŠ‚ç‚¹æ¥ä½¿ç”¨ï¼›ä½¿ç”¨ç»“æŸå½’è¿˜é¡µé¢ï¼Œç”¨ UnpinPageï¼›æ–°å»ºé¡µé¢ç”¨ NewPageï¼Œåˆ é™¤é¡µé¢ç”¨ DeletePageã€‚newæˆ–è€…fetché¡µé¢ä¹‹åï¼Œä¸€å®šè¦è®°å¾—unpinã€‚</p></li></ul><h3 id="GetValue"><a href="#GetValue" class="headerlink" title="GetValue"></a>GetValue</h3><p>å…ˆç”¨ GetLeafPage() æ–¹æ³•æ‰¾åˆ°å¶å­èŠ‚ç‚¹ï¼Œå†åœ¨å¶å­èŠ‚ç‚¹ä¸­å¯»æ‰¾å€¼ã€‚GetLeafPage() ä¸­ç”¨ä¸€ä¸ªwhileå¾ªç¯ï¼Œåªè¦ä¸æ˜¯å¶å­èŠ‚ç‚¹å°±ä¸€ç›´å¾€ä¸‹æ‰¾ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¾ªç¯å†…éƒ¨å¦‚ä½•ç¡®å®šèµ°å“ªæ¡è·¯ï¼ˆç¡®å®šä¸‹ä¸€ä¸ªåˆ°è¾¾çš„å­èŠ‚ç‚¹çš„page_id_</span></span><br><span class="line"><span class="keyword">page_id_t</span> next = cur_node_internal-&gt;<span class="built_in">ValueAt</span>(cur_node_internal-&gt;<span class="built_in">GetSize</span>() - <span class="number">1</span>);  <span class="comment">// åˆå§‹å€¼æ˜¯æœ€åä¸€ä¸ª</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; cur_node_internal-&gt;<span class="built_in">GetSize</span>(); i++) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">comparator_</span>(cur_node_internal-&gt;<span class="built_in">KeyAt</span>(i), key) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    next = cur_node_internal-&gt;<span class="built_in">ValueAt</span>(i - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨å¶å­èŠ‚ç‚¹ä¸­å¯»æ‰¾å€¼çš„è¿‡ç¨‹å¯ä»¥ç”¨äºŒåˆ†æ³•ï¼Œæˆ‘æ‡’å¾—å†™å°±ç›´æ¥éå†äº†ã€‚</p><h3 id="Insert"><a href="#Insert" class="headerlink" title="Insert"></a>Insert</h3><p>å¦‚æœæ˜¯ç©ºæ ‘ï¼Œå°±åˆ›å»ºä¸€ä¸ªæ ¹èŠ‚ç‚¹ã€‚å¦åˆ™å°è¯•å‘å¶å­èŠ‚ç‚¹ä¸­æ’å…¥ã€‚å¦‚æœå¶å­èŠ‚ç‚¹æ’å…¥åæ»¡ï¼Œåˆ™éœ€è¦åˆ†è£‚å¶å­èŠ‚ç‚¹ï¼Œå¹¶æŠŠåˆ†è£‚å‡ºçš„å¶å­èŠ‚ç‚¹çš„ä¿¡æ¯æ’å…¥åˆ°ä¸Šå±‚å†…éƒ¨èŠ‚ç‚¹ä¸­ã€‚å¦‚æœä¸Šå±‚å†…éƒ¨èŠ‚ç‚¹ä¹Ÿæ»¡äº†ï¼Œå°±éœ€è¦å†åˆ†è£‚å¹¶å‘ä¸Šæ’å…¥ï¼Œè¿™æ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ã€‚</p><p>æ³¨æ„å‘ä¸Šæ’å…¥è¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°ä¸å­˜åœ¨ä¸Šå±‚èŠ‚ç‚¹çš„æƒ…å†µï¼Œæ­¤æ—¶éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„æ ¹èŠ‚ç‚¹ï¼Œå†æ’å…¥ã€‚åˆ«å¿˜äº†ä½¿ç”¨ UpdateRootPageId() æ–¹æ³•æ›´æ–° root_page_id_ï¼Œä»¥åŠæ›´æ–°è¢«æ’å…¥å­èŠ‚ç‚¹çš„ parent_page_id_ã€‚</p><p>å†…éƒ¨èŠ‚ç‚¹æ˜¯åœ¨æ’å…¥å‰åˆ¤æ–­æ˜¯å¦æ»¡ï¼Œå¦‚æœæ»¡äº†ï¼Œåˆ†è£‚æ“ä½œä¸å¶å­èŠ‚ç‚¹ç•¥æœ‰ä¸åŒã€‚éœ€è¦å…ˆå¼€è¾Ÿä¸€å—è¾ƒå¤§å†…å­˜ï¼Œå¹¶å¼ºè½¬ä¸º InternalPageï¼Œç„¶åæŠŠå¾…åˆ†è£‚çš„å†…éƒ¨èŠ‚ç‚¹æ‹·è´åˆ°è¿™å—å†…å­˜ä¸­ï¼Œæ’å…¥å­èŠ‚ç‚¹ååˆ†è£‚ï¼Œå†æŠŠåˆ†è£‚åæ‰€å‰©çš„ä¿¡æ¯æ‹·è´å›åŸå¾…åˆ†è£‚çš„å†…éƒ¨èŠ‚ç‚¹ï¼Œæœ€åå†å°†åˆ†è£‚å‡ºçš„èŠ‚ç‚¹å‘ä¸Šæ’å…¥å¹¶é‡Šæ”¾è¿™å—å†…å­˜ã€‚ä»£ç å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> *mem = <span class="keyword">new</span> <span class="keyword">char</span>[INTERNAL_PAGE_HEADER_SIZE + <span class="built_in"><span class="keyword">sizeof</span></span>(MappingType) * (parent_node-&gt;<span class="built_in">GetSize</span>() + <span class="number">1</span>)];</span><br><span class="line"><span class="keyword">auto</span> *copy_parent_node = <span class="keyword">reinterpret_cast</span>&lt;InternalPage *&gt;(mem);</span><br><span class="line">std::<span class="built_in">memcpy</span>(mem, parent_page-&gt;<span class="built_in">GetData</span>(), INTERNAL_PAGE_HEADER_SIZE + <span class="built_in"><span class="keyword">sizeof</span></span>(MappingType) * (parent_node-&gt;<span class="built_in">GetSize</span>()));</span><br><span class="line">copy_parent_node-&gt;<span class="built_in">InsertNodeAfter</span>(old_node-&gt;<span class="built_in">GetPageId</span>(), key, new_node-&gt;<span class="built_in">GetPageId</span>());</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> parent_sibling_node = copy_parent_node-&gt;<span class="built_in">Split</span>(buffer_pool_manager_, comparator_, internal_max_size_);</span><br><span class="line">KeyType new_key = parent_sibling_node-&gt;<span class="built_in">KeyAt</span>(<span class="number">0</span>);</span><br><span class="line">std::<span class="built_in">memcpy</span>(parent_page-&gt;<span class="built_in">GetData</span>(), mem,</span><br><span class="line">          INTERNAL_PAGE_HEADER_SIZE + <span class="built_in"><span class="keyword">sizeof</span></span>(MappingType) * copy_parent_node-&gt;<span class="built_in">GetMinSize</span>());</span><br><span class="line"><span class="built_in">InsertIntoParent</span>(parent_node, new_key, parent_sibling_node, transaction);  <span class="comment">// é€’å½’</span></span><br><span class="line">buffer_pool_manager_-&gt;<span class="built_in">UnpinPage</span>(parent_page-&gt;<span class="built_in">GetPageId</span>(), <span class="literal">true</span>);</span><br><span class="line">buffer_pool_manager_-&gt;<span class="built_in">UnpinPage</span>(parent_sibling_node-&gt;<span class="built_in">GetPageId</span>(), <span class="literal">true</span>);</span><br><span class="line"><span class="keyword">delete</span>[] mem;</span><br></pre></td></tr></table></figure><h3 id="Remove"><a href="#Remove" class="headerlink" title="Remove"></a>Remove</h3><p>åˆ é™¤åï¼Œå¦‚æœèŠ‚ç‚¹è¶³å¤Ÿå¤§ï¼ˆ&gt;= min_sizeï¼‰ï¼Œå°±ä¸ç®¡ã€‚å¦åˆ™æ‰¾åˆ°å…„å¼ŸèŠ‚ç‚¹ï¼ˆè¦æœ‰åŒä¸€ä¸ªçˆ¶èŠ‚ç‚¹ï¼Œå¹¶ä¸”å½¼æ­¤ç›¸é‚»ï¼Œå…ˆæ‰¾å·¦å…„å¼Ÿå†æ‰¾å³å…„å¼Ÿï¼‰ï¼Œçœ‹å…„å¼ŸèŠ‚ç‚¹æ˜¯å¦å¤Ÿå¤§ï¼ˆ&gt; min_sizeï¼‰ï¼Œå¤Ÿå¤§å°±å€Ÿç”¨ä¸€ä¸ªï¼Œå¦åˆ™å’Œå…„å¼ŸèŠ‚ç‚¹åˆå¹¶ã€‚å¯èƒ½å‡ºç°ç‰¹æ®Šæƒ…å†µï¼šæ ¹èŠ‚ç‚¹æ˜¯å¶èŠ‚ç‚¹ä¸”å¤§å°ä¸º0ï¼Œå°†æ ‘ç½®ä¸ºç©ºï¼›æ ¹èŠ‚ç‚¹æ˜¯å†…éƒ¨èŠ‚ç‚¹ä¸”å¤§å°ä¸º1ï¼Œè®©å…¶å­èŠ‚ç‚¹ä½œä¸ºæ–°çš„æ ¹èŠ‚ç‚¹ã€‚</p><p>å€Ÿç”¨æ—¶ï¼Œä¸¤ç§èŠ‚ç‚¹ç±»ä¼¼ï¼Œåªæ˜¯InternalPage ä¼šæ¯” LeafPage ç•¥å¤æ‚ä¸€äº›ã€‚ä¸‹é¢åªè°ˆ InternalPage çš„å€Ÿç”¨ï¼š</p><ul><li>å¦‚æœå…„å¼ŸèŠ‚ç‚¹åœ¨å·¦è¾¹ï¼Œçˆ¶èŠ‚ç‚¹ä¸­å¯¹åº”è‡ªå·±çš„keyè¦æ”¹æˆå·¦å…„å¼Ÿçš„æœ€åä¸€ä¸ªkeyã€‚</li></ul><p><img src="https://s2.loli.net/2023/05/10/6HmadvKg3Q79GkE.png" alt="å‘å·¦å…„å¼Ÿå€Ÿç”¨"></p><ul><li>å¦‚æœå…„å¼ŸèŠ‚ç‚¹åœ¨å³è¾¹ï¼Œå°† çˆ¶èŠ‚ç‚¹ä¸­å¯¹åº”å³å…„å¼Ÿçš„keyâ€”å³å…„å¼Ÿçš„value[0] æ’å…¥åˆ°è‡ªå·±çš„æœ«å°¾ï¼Œç„¶åå°†çˆ¶èŠ‚ç‚¹å¯¹åº”å³å…„å¼Ÿçš„keyæ”¹ä¸ºå³å…„å¼Ÿçš„key[1]ï¼Œå³å…„å¼Ÿåˆ é™¤ç¬¬ä¸€ä¸ªé”®å€¼å¯¹ã€‚</li></ul><p><img src="https://s2.loli.net/2023/05/10/wpiAayxoDLB5NvH.png" alt="å‘å³å…„å¼Ÿå€Ÿç”¨"></p><ul><li>æ³¨æ„å€Ÿç”¨çš„é”®å€¼å¯¹ä¸‹é¢çš„å­èŠ‚ç‚¹è¦æ›´æ”¹ parent_page_id_ã€‚</li></ul><p>åˆå¹¶æ—¶ä¹Ÿæ˜¯ InternalPage ç•¥éº»çƒ¦ä¸€äº›ã€‚å°†å³èŠ‚ç‚¹åˆå¹¶åˆ°å·¦èŠ‚ç‚¹æ—¶ï¼Œç¬¬ä¸€ä¸ªé”®å€¼å¯¹æ˜¯ çˆ¶èŠ‚ç‚¹ä¸­å¯¹åº”å³èŠ‚ç‚¹çš„keyâ€”å³èŠ‚ç‚¹çš„value[0]ã€‚ä¹Ÿåˆ«å¿˜è®°æ›´æ”¹ä¸‹é¢å­èŠ‚ç‚¹çš„ parent_page_id_ã€‚</p><p><strong>ä¸€äº›é¢å¤–çš„å°é—®é¢˜</strong>ï¼š</p><ol><li><p>page_headeråªåœ¨å†…å­˜ä¸­æœ‰å—ï¼Ÿåœ¨ç£ç›˜ä¸Šåªæœ‰page_dataéƒ¨åˆ†å—ï¼Ÿ</p><p>headeråœ¨ç£ç›˜å’Œå†…å­˜ä¸­éƒ½æœ‰ï¼Œåœ¨ BufferPool çš„ page.data_ éƒ¨åˆ†ï¼Œè¢«å¼ºè½¬ä¸ºäº†å†…éƒ¨é¡µæˆ–è€…å¶å­é¡µã€‚</p><img src="https://s2.loli.net/2023/05/12/7RGiAjfKxZhv13P.png" alt="ç»¿è‰²éƒ¨åˆ†æ˜¯ç£ç›˜é¡µï¼Œæ•´ä¸ªç™½è‰²æ¡†å†…æ˜¯å†…å­˜é¡µã€‚Page metadataåŒ…æ‹¬è¢«pinæ¬¡æ•°ã€æ˜¯å¦æ˜¯è„é¡µç­‰" style="zoom: 50%;" /></li><li><p>InternalPage å’Œ LeafPage çš„åŒºåˆ«ï¼š</p><ul><li>headerä¸Šï¼šLeafPage å¤šä¸€ä¸ªå­—æ®µ next_page_id_ï¼Œæ‰€ä»¥å¶å­é¡µheaderæ˜¯28å­—èŠ‚ï¼Œè€Œå†…éƒ¨é¡µæ˜¯24å­—èŠ‚ã€‚</li><li>dataä¸Šï¼šå†…éƒ¨é¡µç¬¬ä¸€ä¸ªkey-valueä¸­keyæ— æ•ˆï¼Œvalueæœ‰æ•ˆã€‚</li></ul></li><li><p>å¤§å¤šæ•°æ•°æ®åº“éƒ½ä½¿ç”¨å”¯ä¸€ç´¢å¼•å»ºç«‹B+æ ‘ï¼Œä¼šå¢åŠ ä¸€ä¸ªéšå¼å”¯ä¸€IDã€‚</p></li></ol><hr><h2 id="ç´¢å¼•è¿­ä»£å™¨"><a href="#ç´¢å¼•è¿­ä»£å™¨" class="headerlink" title="ç´¢å¼•è¿­ä»£å™¨"></a>ç´¢å¼•è¿­ä»£å™¨</h2><p>IndexIterator ç±»æˆå‘˜å˜é‡ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">BufferPoolManager *buffer_pool_manager_;</span><br><span class="line">Page *page_;</span><br><span class="line">LeafPage *leaf_ = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="keyword">int</span> index_ = <span class="number">0</span>;</span><br></pre></td></tr></table></figure><p>å‡ ä¸ªè¦æ³¨æ„çš„ç‚¹ï¼š</p><ul><li>ææ„æ—¶éœ€è¦Unpiné¡µé¢</li><li>*æ“ä½œå°†å–å¾—array_ä¸­çš„ä¸€ä¸ªé”®å€¼å¯¹</li><li>å¯¹äº++æ“ä½œï¼Œå¦‚æœæ­¤æ—¶è¿­ä»£å™¨æŒ‡å‘çš„æ˜¯å½“å‰é¡µçš„æœ€åä¸€ä¸ªé”®å€¼å¯¹ï¼Œéœ€è¦å…ˆå–åˆ°ä¸‹ä¸€é¡µå¹¶é‡Šæ”¾å½“å‰é¡µ</li><li><strong>End() è¿”å› INDEXITERATOR_TYPE(buffer_pool_manager_, page, cur_node-&gt;GetSize())</strong></li><li><strong>IsEnd() åˆ¤æ–­ leaf_-&gt;GetNextPageId() == INVALID_PAGE_ID &amp;&amp; index_ == leaf_-&gt;GetSize()</strong></li></ul><hr><h2 id="å¹¶å‘ç´¢å¼•"><a href="#å¹¶å‘ç´¢å¼•" class="headerlink" title="å¹¶å‘ç´¢å¼•"></a>å¹¶å‘ç´¢å¼•</h2><p>å¯ä»¥å…ˆä¸Šä¸€æŠŠå¤§é”ï¼Œè·‘ä¸€è·‘checkpoint2çœ‹çœ‹å‰é¢çš„å®ç°æœ‰æ²¡æœ‰é—®é¢˜ï¼Œéƒ½é€šè¿‡äº†å†æ¥å†™å¹¶å‘ã€‚</p><p>é”çš„ç²’åº¦æ˜¯é¡µçº§ï¼Œä¸”æ˜¯ç¼“å†²æ± çš„é¡µï¼Œä¸æ˜¯b+æ ‘èŠ‚ç‚¹çš„é¡µã€‚b+æ ‘èŠ‚ç‚¹çš„é¡µæ˜¯ç£ç›˜ä¸Šå­˜å‚¨çš„é¡µï¼Œè€Œç¼“å†²æ± çš„é¡µåŒ…å«èŠ‚ç‚¹é¡µï¼Œå¹¶ä¸”å¸¦æœ‰éƒ¨åˆ†å…ƒæ•°æ®ä¿¡æ¯ã€‚</p><p><strong>åŠ é”çš„åŸºæœ¬æ€æƒ³</strong>æ˜¯ï¼š 1. å…ˆé”ä½ parent pageï¼Œ 2. å†é”ä½ child pageï¼Œ 3. å¦‚æœ child page æ˜¯<em>å®‰å…¨</em>çš„ï¼Œåˆ™é‡Šæ”¾ parent page çš„é”ã€‚å®‰å…¨æŒ‡å½“å‰ page åœ¨å½“å‰æ“ä½œä¸‹ä¸€å®šä¸ä¼šå‘ç”Ÿ Split / Redistribute / Coalesceã€‚åœ¨ child page ä¸å®‰å…¨æ—¶ï¼Œéœ€è¦æŒç»­æŒæœ‰ç¥–å…ˆçš„å†™é”ã€‚å¹¶åœ¨å‡ºç°å®‰å…¨çš„ child page åï¼Œé‡Šæ”¾æ‰€æœ‰ç¥–å…ˆå†™é”ã€‚ç”¨ transaction è®°å½•å“ªäº› page å½“å‰æŒæœ‰é”ã€‚</p><p>å¯¹äº Transaction ç±»ï¼Œåªéœ€è¦å…³æ³¨ä¸‹é¢å‡ ä¸ªæˆå‘˜å˜é‡å’Œå‡½æ•°ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">AddIntoDeletedPageSet</span><span class="params">(<span class="keyword">page_id_t</span> page_id)</span> </span>&#123; deleted_page_set_-&gt;<span class="built_in">insert</span>(page_id); &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">AddIntoPageSet</span><span class="params">(Page *page)</span> </span>&#123; page_set_-&gt;<span class="built_in">push_back</span>(page); &#125;</span><br><span class="line"></span><br><span class="line">std::shared_ptr&lt;std::unordered_set&lt;<span class="keyword">page_id_t</span>&gt;&gt; deleted_page_set_; <span class="comment">// è¦åˆ é™¤çš„page</span></span><br><span class="line">std::shared_ptr&lt;std::deque&lt;Page *&gt;&gt; page_set_; <span class="comment">// ä¸Šé”çš„page</span></span><br></pre></td></tr></table></figure><p>å¯¹äº Page ç±»ï¼Œéœ€è¦å…³æ³¨ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Acquire the page write latch. */</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">WLatch</span><span class="params">()</span> </span>&#123; rwlatch_.<span class="built_in">WLock</span>(); &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Release the page write latch. */</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">WUnlatch</span><span class="params">()</span> </span>&#123; rwlatch_.<span class="built_in">WUnlock</span>(); &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Acquire the page read latch. */</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">RLatch</span><span class="params">()</span> </span>&#123; rwlatch_.<span class="built_in">RLock</span>(); &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Release the page read latch. */</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">RUnlatch</span><span class="params">()</span> </span>&#123; rwlatch_.<span class="built_in">RUnlock</span>(); &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Page latch. */</span></span><br><span class="line">ReaderWriterLatch rwlatch_;</span><br></pre></td></tr></table></figure><p>é™¤äº†å¯¹ page ä¸Šé”ï¼Œè¿˜éœ€è¦å¯¹ root_page_id_ å•ç‹¬ä¸Šé”ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ReaderWriterLatch root_page_id_latch_;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢ç®€è¿°<strong>éƒ¨åˆ†ä¸Šé”è§£é”æµç¨‹</strong>ï¼š</p><ul><li><p>æŸ¥æ‰¾/æ’å…¥/åˆ é™¤æ“ä½œéƒ½éœ€è¦å…ˆåˆ¤æ–­ç©ºæ ‘ï¼Œæ‰€ä»¥<strong>ç»™ root_page_id_ ä¸Šé”</strong>çš„ä»»åŠ¡æ”¾åœ¨å‡½æ•°å¼€å¤´ã€‚æŸ¥æ‰¾æ—¶åŠ è¯»é”ï¼›å…¶ä½™åŠ å†™é”ï¼Œå¹¶å¾€ page_set_ ä¸­åŠ å…¥ä¸€ä¸ªnullptrï¼Œä»£è¡¨ root_page_id_ ä¸Šäº†é”ã€‚</p></li><li><p>æ ¹æ®keyæŸ¥æ‰¾å¶å­èŠ‚ç‚¹æ—¶æ‰€ç”¨çš„ <strong>GetLeafPage()</strong> æ–¹æ³•ï¼Œéœ€è¦å†ä¼ å…¥ä¸€ä¸ªå‚æ•° Operationï¼ˆå®šä¹‰enum class Operation { SEARCH, INSERT, DELETE };ï¼‰ï¼Œç”¨æ¥åŒºåˆ†æƒ…å†µæ–¹ä¾¿å¹¶å‘æ§åˆ¶ã€‚SEARCH æ—¶ï¼Œç›´æ¥è§£é” root_page_id_ ï¼Œç»™æ ¹èŠ‚ç‚¹pageåŠ è¯»é”ï¼Œæ­¤åä¸€ç›´æŒ‰åŠ å­é”ã€è§£çˆ¶é”ï¼ŒUnpinçˆ¶èŠ‚ç‚¹çš„æµç¨‹è¿›è¡Œï¼Œåˆ°æœ€ååªæœ‰å¶å­èŠ‚ç‚¹ä¸Šäº†è¯»é”ã€‚è€Œ  INSERT / DELETE æ—¶ï¼Œå…ˆç»™æ ¹èŠ‚ç‚¹åŠ å†™é”ï¼Œè§†æƒ…å†µï¼ˆæƒ…å†µ1ï¼‰è§£é” root_page_id_ï¼Œæ­¤åä¸€ç›´æŒ‰åŠ å­é”ã€å°†çˆ¶èŠ‚ç‚¹ page_id_ æ”¾å…¥page_set_ã€è§†å­èŠ‚ç‚¹æƒ…å†µï¼ˆæƒ…å†µ2ï¼‰è§£å¼€ä¸Šé¢æ‰€æœ‰é”çš„æµç¨‹è¿›è¡Œï¼Œåˆ°æœ€ååªæœ‰ä¸å®‰å…¨çš„èŠ‚ç‚¹è¢«ä¸Šé”ï¼Œä¸”é™¤å¶å­èŠ‚ç‚¹çš„ä¸å®‰å…¨èŠ‚ç‚¹éƒ½è¢«æ”¾å…¥page_set_ã€‚</p><p>æƒ…å†µ1ï¼šINSERT ä¸”ä¸åˆ†è£‚ï¼Œå³ LeafPageå¤§å° &lt; leaf_max_size_-1 æˆ– InternalPageå¤§å° &lt; internal_max_size_ / DELETE ä¸”æ ¹èŠ‚ç‚¹å¤§å°&gt;2</p><p>æƒ…å†µ2ï¼šINSERT ä¸”ä¸åˆ†è£‚ / DELETE ä¸”ä¸åˆå¹¶æˆ–é‡åˆ†é…ï¼Œå³ èŠ‚ç‚¹å¤§å° &gt; min_size_</p><p>è§£å¼€ä¸Šé¢æ‰€æœ‰é”çš„ä»£ç å®ç°ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">INDEX_TEMPLATE_ARGUMENTS</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BPLUSTREE_TYPE::ReleaseLatchFromQueue</span><span class="params">(Transaction *transaction)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (!transaction-&gt;<span class="built_in">GetPageSet</span>()-&gt;<span class="built_in">empty</span>()) &#123;  <span class="comment">// page_set_:the pages that were latched</span></span><br><span class="line">        Page *page = transaction-&gt;<span class="built_in">GetPageSet</span>()-&gt;<span class="built_in">front</span>();</span><br><span class="line">        transaction-&gt;<span class="built_in">GetPageSet</span>()-&gt;<span class="built_in">pop_front</span>(); <span class="comment">// å…ˆè§£ä¸Šé¢çš„é”</span></span><br><span class="line">        <span class="keyword">if</span> (page == <span class="literal">nullptr</span>) &#123;  <span class="comment">// page_set_ä¸­çš„nullpträ»£è¡¨root_page_id_latch_è¢«åŠ å†™é”</span></span><br><span class="line">        <span class="keyword">this</span>-&gt;root_page_id_latch_.<span class="built_in">WUnlock</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            page-&gt;<span class="built_in">WUnlatch</span>();</span><br><span class="line">            buffer_pool_manager_-&gt;<span class="built_in">UnpinPage</span>(page-&gt;<span class="built_in">GetPageId</span>(), <span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>DELETE æ—¶å¦‚æœè¦å‘å…„å¼ŸèŠ‚ç‚¹å€Ÿç”¨æˆ–åˆå¹¶ï¼Œéœ€è¦<strong>ç»™å…„å¼ŸèŠ‚ç‚¹åŠ å†™é”</strong>ã€‚</p></li><li><p>ä¸Šäº†é”å°±<strong>åˆ«å¿˜è®°è§£é”</strong>ï¼Œé€šå¸¸æ˜¯åœ¨å‡½æ•°returnå‰ ReleaseLatchFromQueue(transaction)ï¼Œå¹¶è§£å¼€å¶å­èŠ‚ç‚¹çš„é”ã€‚</p></li><li><p>å¯¹äº<strong>è¿­ä»£å™¨</strong>æ¥è¯´ï¼Œéœ€è¦åœ¨ææ„æ—¶è§£è¯»é”ï¼Œåœ¨++æ“ä½œæ—¶ä¹Ÿå¯èƒ½éœ€è¦è§£é”åŠ é”ã€‚</p></li></ul><hr><h2 id="ğŸ”®"><a href="#ğŸ”®" class="headerlink" title="ğŸ”®"></a>ğŸ”®</h2><img src="https://s2.loli.net/2023/05/12/C2nyZtEWRvmOVsu.png" style="zoom:50%;" /><p><img src="https://s2.loli.net/2023/05/12/Ic1PehTaqGDgBib.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;åªè®°å½•è‡ªå·±åœ¨å®ç°è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ï¼Œæ‰€ä»¥å†™å¾—ä¸å¤Ÿè¯¦å°½ï¼ˆå½“ç„¶ä¹Ÿä¸ä¼šå…¬å¼€å®Œæ•´ä»£ç &lt;/p&gt;
&lt;h2 id=&quot;B-æ ‘èŠ‚ç‚¹&quot;&gt;&lt;a href=&quot;#B-æ ‘èŠ‚ç‚¹&quot; class=&quot;headerlink&quot; title=&quot;B+æ ‘èŠ‚ç‚¹&quot;&gt;&lt;/a&gt;B+æ ‘èŠ‚ç‚¹&lt;/h2&gt;&lt;p&gt;b+æ ‘ä¸­æœ‰ä¸¤ç§èŠ‚ç‚¹ï¼šå†…éƒ¨èŠ‚</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>CMU15-445ï¼ˆFALL 2022ï¼‰Project 1</title>
    <link href="http://example.com/2023/05/09/p1/"/>
    <id>http://example.com/2023/05/09/p1/</id>
    <published>2023-05-09T07:58:54.777Z</published>
    <updated>2023-05-12T14:09:57.549Z</updated>
    
    <content type="html"><![CDATA[<p>åªè®°å½•è‡ªå·±åœ¨å®ç°è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ï¼Œæ‰€ä»¥å†™å¾—ä¸å¤Ÿè¯¦å°½ï¼ˆå½“ç„¶ä¹Ÿä¸ä¼šå…¬å¼€å®Œæ•´ä»£ç </p><h2 id="å¯æ‰©å±•å“ˆå¸Œè¡¨ï¼ˆextendible-hash-tableï¼‰"><a href="#å¯æ‰©å±•å“ˆå¸Œè¡¨ï¼ˆextendible-hash-tableï¼‰" class="headerlink" title="å¯æ‰©å±•å“ˆå¸Œè¡¨ï¼ˆextendible_hash_tableï¼‰"></a>å¯æ‰©å±•å“ˆå¸Œè¡¨ï¼ˆextendible_hash_tableï¼‰</h2><p>å¯æ‰©å±•å“ˆå¸Œè¡¨ç”±ExtendibleHashTableç±»å®ç°ï¼Œæˆå‘˜å˜é‡æœ‰ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> global_depth_;    <span class="comment">// å…¨å±€æ·±åº¦ï¼Œå…¨å±€æ·±åº¦=ç›®å½•idçš„æ¯”ç‰¹ä½æ•°</span></span><br><span class="line"><span class="keyword">size_t</span> bucket_size_;  <span class="comment">// æ¡¶çš„å¤§å°ï¼šæ¡¶æœ€å¤§å®¹çº³å‡ ä¸ªæ•°æ®</span></span><br><span class="line"><span class="keyword">int</span> num_buckets_;     <span class="comment">// å“ˆå¸Œè¡¨ä¸­æ¡¶çš„æ•°é‡</span></span><br><span class="line"><span class="keyword">mutable</span> std::mutex latch_;</span><br><span class="line">std::vector&lt;std::shared_ptr&lt;Bucket&gt;&gt; dir_;  <span class="comment">// ç›®å½•ï¼šç›®å½•åœ¨æŒ‡é’ˆä¸­å­˜å‚¨æ¡¶çš„åœ°å€ï¼Œæ¯ä¸ªç›®å½•è¢«åˆ†é…ä¸€ä¸ªidï¼Œç›®å½•æ‰©å¼ æ—¶idå¯èƒ½å˜åŒ–ã€‚ç›®å½•æ•°é‡=2^å…¨å±€æ·±åº¦</span></span><br></pre></td></tr></table></figure><p>ExtendibleHashTableç±»ä¸­åµŒå¥—å®šä¹‰äº†Bucketç±»ï¼Œå³æ¡¶ã€‚Bucketç±»çš„æˆå‘˜å˜é‡æœ‰ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">size_t</span> size_;  <span class="comment">// æ¡¶çš„å¤§å°ï¼Œå°±æ˜¯ExtendibleHashTableä¸­çš„bucket_size_</span></span><br><span class="line"><span class="keyword">int</span> depth_;    <span class="comment">// å±€éƒ¨æ·±åº¦</span></span><br><span class="line">std::list&lt;std::pair&lt;K, V&gt;&gt; list_; <span class="comment">// æ‰€è¦å­˜å‚¨çš„æ•°æ®ï¼Œæ˜¯k-vå¯¹</span></span><br></pre></td></tr></table></figure><img src="https://s2.loli.net/2023/05/07/lGqIm7eC3p9LoAM.jpg" alt="å¯æ‰©å±•å“ˆå¸Œè¡¨å›¾ç¤º" style="zoom: 33%;" /><p>å¯¹äºæŸ¥æ‰¾/æ’å…¥/åˆ é™¤æ“ä½œï¼Œéƒ½ä¼šå…ˆæ˜ å°„åˆ°ç›®å½•ï¼Œå†æ˜ å°„åˆ°æ¡¶ã€‚æ¡¶çš„æ•°é‡æ˜¯åŠ¨æ€çš„ï¼Œå½“æ¡¶ä¸­çš„å…ƒç´ è¶…è¿‡bucket_size_æ—¶ï¼Œæ¡¶ä¼šåˆ†è£‚æˆä¸¤ä¸ªéƒ¨åˆ†ã€‚å½“æº¢å‡ºæ¡¶çš„å±€éƒ¨æ·±åº¦ç­‰äºå…¨å±€æ·±åº¦æ—¶ï¼Œå°†å‘ç”Ÿç›®å½•æ‰©å®¹ï¼ˆ2å€ã€‚</p><p><strong>åˆå§‹æ—¶</strong>å“ˆå¸Œè¡¨çš„global_depth_=0ï¼Œnum_buckets_=1ï¼Œå³æœ‰ä¸€ä¸ªç©ºæ¡¶ã€‚æ¡¶æœ€åˆçš„depth_=0ã€‚</p><p>é¡¹ç›®æä¾›äº†IndexOf()æ–¹æ³•ï¼Œç”¨äºæ ¹æ®keyå¾—åˆ°ç›®å½•idï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> K, <span class="keyword">typename</span> V&gt;</span><br><span class="line"><span class="keyword">auto</span> ExtendibleHashTable&lt;K, V&gt;::<span class="built_in">IndexOf</span>(<span class="keyword">const</span> K &amp;key) -&gt; <span class="keyword">size_t</span> &#123;</span><br><span class="line">  <span class="keyword">int</span> mask = (<span class="number">1</span> &lt;&lt; global_depth_) - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> std::hash&lt;K&gt;()(key) &amp; mask; <span class="comment">// keyå“ˆå¸Œåï¼Œæœ«å°¾ä¿ç•™global_depth_æ¯”ç‰¹ä½</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">size_t</span> index = <span class="built_in">IndexOf</span>(key);</span><br><span class="line">std::shared_ptr&lt;Bucket&gt; bucket_ptr = dir_[index]; <span class="comment">// æ‹¿åˆ°æŒ‡å‘æ¡¶çš„æŒ‡é’ˆ</span></span><br></pre></td></tr></table></figure><p>ç°è¯¦è¿°<strong>æ’å…¥æ•°æ®</strong>çš„è¿‡ç¨‹ï¼š</p><p>å…ˆé€šè¿‡IndexOf()æ–¹æ³•ç¡®å®šè¦æŠŠæ•°æ®æ’å…¥å“ªä¸€ä¸ªæ¡¶ä¸­ï¼Œæ‹¿åˆ°è¿™ä¸ªæ¡¶ã€‚çœ‹list_.size()==size_æ˜¯å¦ä¸ºçœŸæ¥åˆ¤æ–­æ¡¶æ˜¯å¦æ»¡ï¼Œå¦‚æœæ»¡äº†å°±éœ€è¦å…ˆè¿›è¡Œæ¡¶åˆ†è£‚å†æ’å…¥ï¼ˆä½†ä¹Ÿæœ‰ä¾‹å¤–ï¼šå¦‚æœæ¡¶é‡Œå·²ç»æœ‰è¿™ä¸ªkeyåªéœ€æ›´æ–°å…¶valueï¼‰ï¼Œå¦åˆ™ç›´æ¥æ’å…¥æ•°æ®ã€‚æ³¨æ„æ¡¶åˆ†è£‚å¯èƒ½å‘ç”Ÿå¤šæ¬¡ï¼ˆå› ä¸ºå¯èƒ½æ‹†åˆ†æ¡¶æ—¶ï¼Œæ‰€æœ‰æ•°æ®æµå‘äº†åŒä¸€ä¸ªæ¡¶ï¼‰ï¼Œæ‰€ä»¥éœ€è¦ç”¨whileåˆ¤æ–­æ¡¶æ˜¯å¦æ»¡äº†ï¼Œè€Œéä½¿ç”¨ifã€‚åœ¨æ¡¶å·²æ»¡çš„å‰æä¸‹ï¼Œå¦‚æœè¯¥æ¡¶çš„å±€éƒ¨æ·±åº¦ç­‰äºå…¨å±€æ·±åº¦ï¼Œåˆ™éœ€è¦è¿›è¡Œç›®å½•æ‰©å®¹ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç›®å½•æ‰©å®¹</span></span><br><span class="line">global_depth_++;</span><br><span class="line"><span class="keyword">size_t</span> len = dir_.<span class="built_in">size</span>();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;  <span class="comment">// ä¸ºæ‰©å¼ çš„æ–°ç›®å½•åˆ†å‘æ¡¶</span></span><br><span class="line">dir_.<span class="built_in">emplace_back</span>(dir_[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸éš¾å‘ç°ç›®å½•æ‰©å®¹åå“ˆå¸Œè¡¨ä¼šå˜æˆè¿™æ ·ï¼š</p><img src="https://s2.loli.net/2023/05/07/fSogk6amwZGnxRu.jpg" alt="ä¼šæœ‰å¤šä¸ªç›®å½•æŒ‡é’ˆæŒ‡å‘åŒä¸€ä¸ªæ¡¶" style="zoom:25%;" /><p>è¦æŠŠæ‰©å®¹çš„ç‚¹æŒ‡å‘å…±åŒçš„æ¡¶ï¼Œæ¯”å¦‚01æ‰©å®¹åˆ°ä¸‰ä½æ—¶å˜æˆ0<strong>01</strong>å’Œ1<strong>01</strong>ï¼Œä¸¤ä¸ªç›®å½•éœ€è¦åŒæ—¶æŒ‡å‘åŸ01çš„æ¡¶ï¼Œå› ä¸ºåœ¨æ²¡æœ‰åˆ†è£‚ä¹‹å‰ï¼Œæ—§æ•°æ®å“ˆå¸ŒåæŒ‡å‘ã€‚</p><p>ç„¶åå°†è¿™ä¸ªå¾…åˆ†è£‚æ¡¶çš„å±€éƒ¨æ·±åº¦+1ï¼Œæ‹†åˆ†æ¡¶å¹¶é‡æ–°åˆ†å‘ç›®å½•æŒ‡é’ˆå’Œk-vå¯¹ã€‚åˆ«å¿˜äº†æ‹†åˆ†å®Œåå°†æ¡¶çš„æ•°é‡+1ã€‚æ‹†åˆ†æ¡¶çš„å®ç°ç»†èŠ‚å¦‚ä¸‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> mask = <span class="number">1</span> &lt;&lt; bucket_ptr-&gt;<span class="built_in">GetDepth</span>(); <span class="comment">// æ­¤æ—¶å±€éƒ¨æ·±åº¦è¿˜æœª+1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span> &amp;it : list) &#123;  <span class="comment">// listæ˜¯å¾…åˆ†è£‚æ¡¶çš„list_</span></span><br><span class="line">    <span class="keyword">size_t</span> hash_key = std::hash&lt;K&gt;()(it.first);</span><br><span class="line">    <span class="keyword">if</span> ((hash_key &amp; mask) != <span class="number">0U</span>) &#123;  <span class="comment">// ä½ä½ç›¸åŒï¼Œåªéœ€è¦åˆ¤æ–­é«˜ä½æ˜¯0è¿˜æ˜¯1</span></span><br><span class="line">    new_bucket0-&gt;<span class="built_in">Insert</span>(it.first, it.second); <span class="comment">// new_bucket0å’Œnew_bucket1ä¼šæˆä¸ºæ‹†åˆ†åçš„ä¸¤ä¸ªæ¡¶çš„æŒ‡é’ˆ</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    new_bucket1-&gt;<span class="built_in">Insert</span>(it.first, it.second);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; dir_.<span class="built_in">size</span>(); i++) &#123; <span class="comment">// éå†ç›®å½•ï¼Œæ‰¾å‡ºåŸæ¡¶æŒ‡é’ˆçš„ä½ç½®ï¼Œç”¨new_bucket0å’Œnew_bucket1ä»£æ›¿</span></span><br><span class="line">    <span class="keyword">if</span> (dir_[i] == bucket_ptr) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((i &amp; mask) != <span class="number">0U</span>) &#123;  <span class="comment">// åˆ¤æ–­é«˜ä½æ˜¯0è¿˜æ˜¯1</span></span><br><span class="line">          dir_[i] = new_bucket0;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          dir_[i] = new_bucket1;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç”»å‡ºä¸€ç§å¯èƒ½çš„æƒ…å†µï¼š</p><img src="https://s2.loli.net/2023/05/08/PO7pNGsButDwRHS.jpg" alt="æ­¤å¤„mask=100ï¼ˆäºŒè¿›åˆ¶" style="zoom:33%;" /><p>æ ¹æ®æ¡¶çš„å±€éƒ¨æ·±åº¦å¾—åˆ°maskï¼Œå†ç”¨maskå’Œæ•°æ®çš„å“ˆå¸Œå€¼è¿›è¡Œ&amp;æ“ä½œåŒºåˆ†é«˜ä½ï¼Œä»è€ŒæŠŠæ¡¶ä¸­æ•°æ®åˆ†æˆä¸¤ä»½ï¼Œç±»ä¼¼çš„ï¼Œç”¨maskå’Œç›®å½•idç›¸ä¸ï¼Œå°†æ–°æ¡¶å’Œç›®å½•åŒ¹é…ã€‚</p><p>å®é™…ä¸Šå“ˆå¸Œè¡¨çš„æ ¹æœ¬åŸç†å°±æ˜¯æŠŠæ•°æ®å“ˆå¸Œï¼Œç”¨è¿™ä¸ªå“ˆå¸Œå€¼æ¥å°†æ•°æ®åˆ†ç±»ã€‚æœ€å¼€å§‹æ•°æ®é‡å°‘çš„æ—¶å€™ä¸ç”¨åˆ†ç±»ï¼Œéƒ½æ”¾åœ¨ä¸€ä¸ªæ¡¶é‡Œï¼›ç„¶åæ•°æ®å¤šä¸€äº›äº†ï¼Œå°±çœ‹æ•°æ®å¯¹åº”å“ˆå¸Œå€¼çš„æœ€ä½ä½æ˜¯0è¿˜æ˜¯1ï¼Œå°†æ•°æ®åˆ†æˆä¸¤ä»½å³å¯ï¼›æ•°æ®æ›´å¤šï¼Œå°±å†çœ‹å“ˆå¸Œå€¼çš„ç¬¬äºŒä½ä½â€¦â€¦ä»¥æ­¤ç±»æ¨ï¼Œé€æ¸ç»†åˆ†æ•°æ®ï¼Œä¿è¯æ¯ä¸ªæ¡¶éƒ½æ²¡æœ‰æº¢å‡ºå°±å¥½ã€‚</p><p><strong>å¹¶å‘æ§åˆ¶</strong>å°±ç”¨ä¸€æŠŠå¤§é”å®ç°ã€‚åœ¨ExtendibleHashTableç±»ä¸­å®šä¹‰æˆå‘˜ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mutable</span> std::mutex latch_;</span><br></pre></td></tr></table></figure><p>ç„¶åExtendibleHashTableç±»æˆå‘˜å‡½æ•°å¼€å¤´ä¸Šé”å³å¯ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::scoped_lock&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(latch_)</span></span>;</span><br></pre></td></tr></table></figure><hr><h2 id="LRU-K-æ·˜æ±°ç­–ç•¥"><a href="#LRU-K-æ·˜æ±°ç­–ç•¥" class="headerlink" title="LRU-K æ·˜æ±°ç­–ç•¥"></a>LRU-K æ·˜æ±°ç­–ç•¥</h2><p>ä¸æ»¡kæ¬¡FIFOï¼Œæ»¡kæ¬¡LRUã€‚ä¼˜å…ˆä»å†å²é˜Ÿåˆ—ä¸­æ·˜æ±°ã€‚</p><img src="https://s2.loli.net/2023/05/08/WuJRm25OBZhoilr.png" style="zoom: 50%;" /><p>LRUKReplacerç±»ä¸­æˆå‘˜å˜é‡æœ‰ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[[maybe_unused]] <span class="keyword">size_t</span> current_timestamp_&#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="keyword">size_t</span> curr_size_&#123;<span class="number">0</span>&#125;; <span class="comment">// LRUKReplacerçš„å¤§å°ï¼ŒLRUKReplacerä¸­å¯é©±é€çš„ç¼“å­˜å¸§çš„æ•°é‡ï¼ŒSize()æ–¹æ³•è¿”å›è¿™ä¸ª</span></span><br><span class="line"><span class="keyword">size_t</span> replacer_size_; <span class="comment">// LRUKReplaceræœ€å¤šç¼“å­˜å¤šå°‘å¸§</span></span><br><span class="line"><span class="keyword">size_t</span> k_;</span><br><span class="line">std::mutex latch_;</span><br><span class="line"></span><br><span class="line">std::unordered_map&lt;<span class="keyword">frame_id_t</span>, <span class="keyword">bool</span>&gt; is_evictable_; <span class="comment">// æ ‡è®°æ˜¯å¦å¯é©±é€</span></span><br><span class="line"><span class="comment">// ä¸æ»¡kæ¬¡ï¼Œæ”¾åœ¨å†å²é˜Ÿåˆ—ä¸­</span></span><br><span class="line">std::list&lt;<span class="keyword">frame_id_t</span>&gt; history_frames_; <span class="comment">// å†å²é˜Ÿåˆ—</span></span><br><span class="line">std::unordered_map&lt;<span class="keyword">frame_id_t</span>, std::list&lt;<span class="keyword">frame_id_t</span>&gt;::iterator&gt; history_pos_; <span class="comment">// ç”¨äºè®°å½•å¸§åœ¨é˜Ÿåˆ—ä¸­çš„ä½ç½®ï¼Œä¾¿äºåˆ é™¤æ“ä½œ</span></span><br><span class="line">std::unordered_map&lt;<span class="keyword">frame_id_t</span>, <span class="keyword">size_t</span>&gt; history_times_; <span class="comment">// è®°å½•è®¿é—®æ¬¡æ•°</span></span><br><span class="line"><span class="comment">// æ»¡kæ¬¡ï¼Œæ”¾åœ¨ç¼“å­˜é˜Ÿåˆ—ä¸­</span></span><br><span class="line">std::list&lt;<span class="keyword">frame_id_t</span>&gt; cache_frames_; <span class="comment">// ç¼“å­˜é˜Ÿåˆ—</span></span><br><span class="line">std::unordered_map&lt;<span class="keyword">frame_id_t</span>, std::list&lt;<span class="keyword">frame_id_t</span>&gt;::iterator&gt; cache_pos_;</span><br></pre></td></tr></table></figure><p>è¦å®ç°çš„æ–¹æ³•ï¼š</p><ul><li><p>Evict(frame_id_t*)ï¼Œé©±é€ä¸€å¸§</p><p>é©±é€åè¦æ ‡è®°ä¸ºä¸å¯é©±é€ï¼Œä»é˜Ÿåˆ—ï¼ˆå½“ç„¶ä¹ŸåŒ…æ‹¬ä½ç½®è®°å½•çš„mapã€è®¿é—®æ¬¡æ•°è®°å½•çš„mapï¼‰ä¸­åˆ é™¤ï¼Œcurr_size_â€“</p></li><li><p>RecordAccess(frame_id_t)ï¼Œè®°å½•è®¿é—®</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(frame_id &gt; <span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(replacer_size_))&#123;  <span class="comment">// æ³¨æ„ç±»å‹è½¬æ¢</span></span><br><span class="line">    <span class="keyword">throw</span> std::<span class="built_in">exception</span>();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœç¬¬ä¸€æ¬¡è®¿é—®ï¼šæ³¨æ„å°†å¸§æ ‡è®°ä¸ºä¸å¯é©±é€ã€‚ç„¶åæŠŠå¸§åŠ åˆ°å†å²é˜Ÿåˆ—æœ«å°¾ï¼ŒåŒæ—¶æ›´æ–°history_pos_ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">history_pos_.<span class="built_in">insert</span>(std::<span class="built_in">make_pair</span>(frame_id, --history_frames_.<span class="built_in">end</span>()));</span><br></pre></td></tr></table></figure></li><li><p>SetEvictable(frame_id_t, bool set_evictable)ï¼Œæ§åˆ¶å¸§æ˜¯å¦å¯é©±é€ï¼Œä»¥åŠLRUKReplacerçš„å¤§å°</p><p>å¦‚æœåœ¨is_evictable_é‡Œé¢æ²¡æœ‰è®°å½•æˆ–è€…set_evictableå’Œis_evictable_é‡Œé¢çš„è®°å½•ä¸€è‡´ï¼Œå°±ä¸ç®¡ã€‚å¦åˆ™å°†is_evictable_ä¸­çš„è®°å½•æ›´æ–°ã€‚å†çœ‹è¯¥å¸§æ˜¯å¦å­˜åœ¨äºLRUKReplacerä¸­ï¼Œè‹¥å­˜åœ¨ï¼Œå†æ›´æ”¹curr_size_çš„å¤§å°</p></li><li><p>Remove(frame_id_t)ï¼Œæ¸…é™¤è®¿é—®è®°å½•</p><p>å’ŒEvictç±»ä¼¼ï¼Œåªä¸è¿‡æ˜¯æŒ‡å®šäº†é©±é€çš„å¸§ã€‚å¦‚æœåœ¨is_evictable_é‡Œé¢æ²¡æœ‰è®°å½•ï¼Œæˆ–æ˜¯è®°å½•ä¸ºfalseï¼Œæˆ–æ˜¯ä¸å­˜åœ¨äºLRUKReplacerä¸­ï¼Œç›´æ¥è¿”å›ã€‚å¦åˆ™åˆ é™¤ï¼Œå¹¶æŠŠis_evictable_ä¸­çš„è®°å½•ç½®ä¸ºfalseï¼Œcurr_size_â€“</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">history_frames_.<span class="built_in">erase</span>(history_pos_[frame_id]); <span class="comment">// åˆ é™¤æ—¶æ ¹æ®history_pos_ä¸­çš„è®°å½•æ¥åˆ </span></span><br></pre></td></tr></table></figure></li><li><p>Size()</p><p>è¿”å›curr_size_</p></li></ul><p>ä¸ªäººè§‰å¾—éš¾ç‚¹åœ¨äºå¯¹curr_size_çš„æŠŠæ§ã€‚</p><p>å¹¶å‘æ§åˆ¶è¿˜æ˜¯ä¸€æŠŠå¤§é”ï¼Œå’Œå¯æ‰©å±•å“ˆå¸Œä¸€æ ·ã€‚</p><hr><h2 id="ç¼“å†²æ± ç®¡ç†å™¨ï¼ˆBufferPoolManagerInstanceï¼‰"><a href="#ç¼“å†²æ± ç®¡ç†å™¨ï¼ˆBufferPoolManagerInstanceï¼‰" class="headerlink" title="ç¼“å†²æ± ç®¡ç†å™¨ï¼ˆBufferPoolManagerInstanceï¼‰"></a>ç¼“å†²æ± ç®¡ç†å™¨ï¼ˆBufferPoolManagerInstanceï¼‰</h2><p>ä¸€äº›åŸºæœ¬æ¦‚å¿µï¼š</p><ul><li><p>page_id ä¸ frame_id</p><p>ç£ç›˜è¢«åˆ’åˆ†ä¸ºè‹¥å¹²å—ï¼ˆé¡µï¼‰ï¼Œæ¯ä¸ªå—éƒ½ç”¨å”¯ä¸€çš„ page_id æ¥æ ‡è¯†ï¼Œdisk_manager å°±æ˜¯æ ¹æ® page_id æ¥è¯»å–å’Œå†™å…¥ç£ç›˜é¡µã€‚</p><p>ç£ç›˜é¡µåŠ è½½åˆ°å†…å­˜ï¼Œå†…å­˜ä¸­ä¹Ÿéœ€è¦æœ‰ç›¸åº”çš„å†…å­˜é¡µï¼ˆäººä¸ºåˆ’åˆ†çš„å†…å­˜é¡µï¼Œä¹Ÿç§°ä¸ºå¸§ï¼‰ï¼ŒBufferPoolManager ç®¡ç†çš„æ­£æ˜¯è¿™äº›å†…å­˜å—ï¼Œå’Œç£ç›˜ç±»ä¼¼ï¼Œå†…å­˜é¡µä¹Ÿæœ‰ç›¸åº”çš„æ ‡è¯† frame_id æ¥å”¯ä¸€æ ‡è®°è¿™äº›å†…å­˜é¡µã€‚</p></li><li><p>Pin ä¸ Unpin</p><p>Pinï¼šæŠŠ frame_id å¯¹åº”é¡µé¢å‰”é™¤ lru_listï¼Œ è¡¨ç¤ºè¯¥é¡µé¢è¢«çº¿ç¨‹å ç”¨ï¼Œä¸å¯ä»¥è¢«ç½®æ¢å‡ºå»ã€‚</p><p>Unpinï¼šæŠŠ frame_id å¯¹åº”çš„é¡µé¢åŠ å…¥ lru_listï¼Œè¡¨ç¤ºè¯¥é¡µé¢å¯ä»¥è¢«åŠ å…¥lru_replacerã€‚</p></li><li><p>Page</p><p>ç³»ç»Ÿä¸­çš„æ‰€æœ‰å†…å­˜é¡µé¢éƒ½ç”± Page å¯¹è±¡è¡¨ç¤ºã€‚Page å¯¹è±¡ä¸»è¦ç”± metadata å’Œ data_[] ä¸¤éƒ¨åˆ†æ„æˆï¼Œmetedata æ˜¯ä¸€äº›å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¦‚ page_id_, pin_count_ã€is_dirty_ç­‰ï¼Œè€Œ data_å­—ç¬¦æ•°ç»„åˆ™æ˜¯å­˜å‚¨ç£ç›˜é¡µçš„å…·ä½“æ•°æ®å†…å®¹ã€‚ Page å¯¹è±¡æ˜¯å¯ä»¥è¢«é‡ç”¨çš„ï¼Œå³æ¯ä¸ªPage å¯¹è±¡éƒ½å¯ä»¥è£…å…¥ä¸åŒçš„ç£ç›˜é¡µé¢ã€‚</p><p>pin_count_ï¼šç”¨äºè®°å½•å½“å‰å†…å­˜é¡µè¢«å ç”¨çš„çº¿ç¨‹æ•°é‡ã€‚NewPgImp å pin_count_ = 1, FetchPgImp åpin_count_++, UnpinPg å pin_count_â€“-, pin_count_ ä¸º 0 åå¯ä»¥é€å‡º LRUReplacerã€‚</p><p>is_dirty_ï¼šç”¨äºè®°å½•å½“å‰å†…å­˜é¡µæ•°æ®æ˜¯å¦è¢«ä¿®æ”¹ï¼ˆç›¸å¯¹äºç£ç›˜æ•°æ®ï¼‰ã€‚</p></li></ul><p>å†æ¥çœ‹BufferPoolManagerInstanceç±»çš„æˆå‘˜å˜é‡ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">size_t</span> pool_size_; <span class="comment">// ç¼“å†²æ± èƒ½å¤Ÿç®¡ç†çš„æœ€å¤§å†…å­˜é¡µæ•°é‡ï¼Œå®é™…ä¸Šå°±æ˜¯pages_æ•°ç»„çš„å¤§å°</span></span><br><span class="line">std::atomic&lt;<span class="keyword">page_id_t</span>&gt; next_page_id_ = <span class="number">0</span>; <span class="comment">// ä¸‹ä¸€ä¸ªå°†è¢«åˆ†é…çš„page_idï¼Œåœ¨åˆ›å»ºæ–°é¡µæ—¶ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">size_t</span> bucket_size_ = <span class="number">4</span>; <span class="comment">// å¯æ‰©å±•å“ˆå¸Œè¡¨ä¸­æ¡¶çš„å¤§å°</span></span><br><span class="line"></span><br><span class="line">Page *pages_; <span class="comment">// Pageç±»å‹å¯¹è±¡çš„æ•°ç»„ï¼Œå¯å°†æ•°ç»„ç´¢å¼•è§†ä¸ºè¯¥é¡µå¯¹åº”çš„frame_id</span></span><br><span class="line">DiskManager *disk_manager_ __attribute__((__unused__)); <span class="comment">// ç£ç›˜ç®¡ç†å™¨ï¼Œç”¨äºæ‰§è¡Œä¸ç£ç›˜ç›¸å…³çš„åº•å±‚æ“ä½œï¼Œå¸¸ç”¨çš„æœ‰å†™å…¥æ•°æ®åˆ°ç£ç›˜WritePageå’Œä»ç£ç›˜è¯»å–æ•°æ®ReadPage</span></span><br><span class="line">LogManager *log_manager_ __attribute__((__unused__));</span><br><span class="line">ExtendibleHashTable&lt;<span class="keyword">page_id_t</span>, <span class="keyword">frame_id_t</span>&gt; *page_table_; <span class="comment">// page_table_ï¼Œç”¨äºé¡µé¢æ˜ å°„</span></span><br><span class="line">LRUKReplacer *replacer_; <span class="comment">// replacer_,é¡µé¢ç½®æ¢ç­–ç•¥</span></span><br><span class="line">std::list&lt;<span class="keyword">frame_id_t</span>&gt; free_list_; <span class="comment">// ç©ºé—²å†…å­˜é¡µé“¾è¡¨ï¼Œåˆšå®ä¾‹åŒ–BPMæ—¶ï¼Œæ‰€æœ‰çš„é¡µé¢éƒ½åº”è¯¥åŠ å…¥free_list_, æ­¤æ—¶LRUReplacerä¸ºç©ºï¼Œæ²¡æœ‰å¯ä»¥ç½®æ¢çš„é¡µé¢</span></span><br><span class="line">std::mutex latch_;</span><br></pre></td></tr></table></figure><p>è¦å®ç°çš„æ–¹æ³•ï¼š</p><ul><li><p>NewPgImp(page_id)ï¼šä»ç£ç›˜åˆ›å»ºä¸€ä¸ªæ–°çš„ç‰©ç†é¡µï¼Œç„¶ååœ¨å†…å­˜ BufferPool æ‰¾åˆ°ä¸€ä¸ªä½ç½®æ”¾å…¥ã€‚å› ä¸ºæ–°ç”³è¯·çš„ç‰©ç†é¡µæ²¡æœ‰æœ‰æ•ˆçš„ dataï¼Œæ‰€ä»¥ NewPgImp ä¸éœ€è¦ ReadPage æ“ä½œï¼Œåªéœ€è¦å®Œæˆå…ƒæ•°æ®æ›´æ–°ï¼ŒResetMemory å³å¯ã€‚ä¼˜å…ˆä½¿ç”¨free_list_ä¸­çš„ç©ºé—´ï¼Œå¦åˆ™ä»replacer_ä¸­é©±é€ä¸€é¡µï¼Œè…¾å‡ºç©ºé—´ã€‚æ”¾å…¥ BufferPool éœ€è¦ï¼šå°†é¡µé¢æ˜ å°„å…³ç³»åŠ å…¥page_table_ã€æ”¾å…¥replacer_ã€æ›´æ–°pages_æ•°ç»„ä¸­å¯¹åº”é¡µé¢çš„ä¿¡æ¯ã€‚</p><p>æ³¨æ„replacer_ä¸­é©±é€ä¸€é¡µæ—¶éœ€è¦å…ˆåˆ¤æ–­è¯¥é¡µæ˜¯å¦è„ï¼Œè‹¥è„è¦å†™å›ç£ç›˜ã€‚</p></li><li><p>FetchPgImp(page_id)ï¼šä¼˜å…ˆä» BufferPool å– page_id å¯¹åº”é¡µé¢ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä»ç£ç›˜è°ƒå…¥ï¼ˆè¿˜æ˜¯ä¼˜å…ˆä½¿ç”¨free_list_ä¸­çš„ç©ºé—´ï¼Œå¦åˆ™ä»replacer_ä¸­é©±é€ä¸€é¡µï¼Œè…¾å‡ºç©ºé—´ï¼‰ï¼Œä¼šæŠŠæ•°æ®ä¸€èµ·å†™å…¥ BufferPool å†…å­˜é¡µã€‚</p></li><li><p>UnpinPgImp(page_id, is_dirty)ï¼šæ³¨æ„ä»…å½“ is_dirty ä¸ºçœŸæ—¶æ‰è€ƒè™‘æ”¹å˜ is_dirty_ å±æ€§ã€‚</p></li><li><p>FlushPgImp(page_id) ä¸ FlushAllPagesImpl()ï¼šå°†é¡µå†™å›ç£ç›˜ã€‚</p></li><li><p>DeletePgImp(page_id)ï¼šå¦‚æœ pin_count&gt;0ï¼Œä¸èƒ½åˆ é™¤ã€‚æ³¨æ„å°†page_table_ã€replacer_ã€pages_æ•°ç»„ä¸­çš„æœ‰å…³ä¿¡æ¯ä¸€å¹¶æ¸…é™¤ï¼Œå¹¶æŠŠå¯¹åº”çš„frame_id æ”¾å›free_list_ã€‚</p></li></ul><p>ä¸€å¼€å§‹æ²¡æœ‰ç†è§£ BufferPool çš„æ¶æ„ï¼Œè‹¦æ¼äº†å¥½ä¸€é˜µå­ã€‚ç†è§£ä¹‹åå®ç°æ—¶å¤šæ³¨æ„ç»†èŠ‚å°±å¥½äº†ã€‚</p><p>å¹¶å‘æ§åˆ¶ï¼šä¸€æŠŠå¤§é”ã€‚</p><hr><h2 id="ğŸˆ"><a href="#ğŸˆ" class="headerlink" title="ğŸˆ"></a>ğŸˆ</h2><img src="https://s2.loli.net/2023/05/09/KOoi1dn8PmGsTxk.png" style="zoom:50%;" /><p><img src="https://s2.loli.net/2023/05/09/mOgUWhGeEo5i3AJ.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;åªè®°å½•è‡ªå·±åœ¨å®ç°è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ï¼Œæ‰€ä»¥å†™å¾—ä¸å¤Ÿè¯¦å°½ï¼ˆå½“ç„¶ä¹Ÿä¸ä¼šå…¬å¼€å®Œæ•´ä»£ç &lt;/p&gt;
&lt;h2 id=&quot;å¯æ‰©å±•å“ˆå¸Œè¡¨ï¼ˆextendible-hash-tableï¼‰&quot;&gt;&lt;a href=&quot;#å¯æ‰©å±•å“ˆå¸Œè¡¨ï¼ˆextendible-hash-tableï¼‰&quot; class=&quot;headerli</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>CMU15-445ï¼ˆFALL 2022ï¼‰Project 0</title>
    <link href="http://example.com/2023/05/05/p0/"/>
    <id>http://example.com/2023/05/05/p0/</id>
    <published>2023-05-05T01:41:37.103Z</published>
    <updated>2023-05-12T14:09:46.398Z</updated>
    
    <content type="html"><![CDATA[<p>åªè®°å½•è‡ªå·±åœ¨å®ç°è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ï¼Œæ‰€ä»¥å†™å¾—ä¸å¤Ÿè¯¦å°½ï¼ˆå½“ç„¶ä¹Ÿä¸ä¼šå…¬å¼€å®Œæ•´ä»£ç </p><p>ç”¨æ—¶ä¸¤ä¸ªæœˆç´§èµ¶æ…¢èµ¶åœ°ç»ˆäºåšå®Œäº†p3ã€‚æœ¬æ¥æ˜¯æ‰“ç®—ç­‰å…¨éƒ¨åšå®Œå†å¼€å§‹å†™åšå®¢çš„ï¼Œä½†æ˜¯æˆ‘çªç„¶æœ‰äº†ä¸€ç§å¾ˆç´¯æƒ³æ­‡æ­‡çš„æ„Ÿè§‰ï¼Œæ‰€ä»¥å¹²è„†å…ˆå†™å†™åšå®¢ã€è§£å†³ä¸‹ä¹‹å‰é—ç•™çš„é—®é¢˜ï¼Œä¼‘æ¯ä¸€é˜µå­å†ç ”ç©¶p4å§ã€‚</p><h2 id="å¼€å§‹çš„å¼€å§‹â€”â€”ç¯å¢ƒæ­å»º"><a href="#å¼€å§‹çš„å¼€å§‹â€”â€”ç¯å¢ƒæ­å»º" class="headerlink" title="å¼€å§‹çš„å¼€å§‹â€”â€”ç¯å¢ƒæ­å»º"></a>å¼€å§‹çš„å¼€å§‹â€”â€”ç¯å¢ƒæ­å»º</h2><p>æˆ‘çš„ç¯å¢ƒï¼šLinuxè™šæ‹Ÿæœºï¼ˆUbuntu20.04.4ï¼‰+ vscodeè¿œç¨‹è¿æ¥ï¼Œä¸ªäººè§‰å¾—æŒºèˆ’æœçš„</p><p>æ³¨æ„2022ç§‹çš„ä»£ç ä»“åº“åœ¨è¿™é‡Œï¼š<a href="https://github.com/cmu-db/bustub/releases/tag/v20221128-2022fall">https://github.com/cmu-db/bustub/releases/tag/v20221128-2022fall</a> ï¼Œä¸è¦ä¸å°å¿ƒæŠŠæœ€æ–°ç‰ˆæœ¬çš„æ‹‰ä¸‹æ¥</p><hr><h2 id="å®ç°ä¸€é¢—å­—å…¸æ ‘"><a href="#å®ç°ä¸€é¢—å­—å…¸æ ‘" class="headerlink" title="å®ç°ä¸€é¢—å­—å…¸æ ‘"></a>å®ç°ä¸€é¢—å­—å…¸æ ‘</h2><img src="https://s2.loli.net/2023/05/05/GZ4quAjsOytIQnE.jpg" alt="å­—å…¸æ ‘å›¾ç¤º" style="zoom: 25%;" /><p>å›¾ç¤ºæ˜¯ä¸€é¢—å­—å…¸æ ‘ï¼Œå…¶ä¸­å…±æœ‰5å¯¹é”®å€¼å¯¹ï¼š(â€œabâ€,1)ï¼Œ(â€œacâ€,2)ï¼Œ(â€œbcâ€,3)ï¼Œ(â€œbcdâ€,4)ï¼Œ(â€œbefâ€,5)ã€‚å› ä¸ºä¸å…è®¸æ’å…¥é‡å¤keyï¼Œæ‰€ä»¥å®é™…ä¸Šä¸€é¢—å­—å…¸æ ‘é‡Œæœ‰å‡ ä¸ªTrieNodeWithValueå°±æœ‰å‡ ä¸ªkeyã€‚</p><p><strong>å¦‚ä½•éå†å­—å…¸æ ‘ï¼Ÿ</strong>æ’å…¥ã€åˆ é™¤å’ŒæŸ¥æ‰¾æ“ä½œéƒ½ç¦»ä¸å¼€éå†ã€‚æ³¨æ„Trieç±»ä¸­çš„æˆå‘˜ï¼Œæ ¹èŠ‚ç‚¹root_ç”¨ä¸€ä¸ªunique_ptræ¥è¡¨ç¤ºï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">std::unique_ptr&lt;TrieNode&gt; root_;</span><br></pre></td></tr></table></figure><p>éå†éƒ½ä»æ ¹èŠ‚ç‚¹å¼€å§‹ã€‚å®šä¹‰ä¸€ä¸ªæŒ‡å‘root_çš„unique_ptrï¼Œå‘½åä¸ºcurï¼Œæ­¤åå°±åˆ©ç”¨curæ¥éå†ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">std::unique_ptr&lt;TrieNode&gt; *cur = &amp;root_;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¾€ä¸‹éå†ä¸€æ­¥ï¼Œèµ°åˆ°key_char_=key_charçš„èŠ‚ç‚¹ä¸Š</span></span><br><span class="line">std::unique_ptr&lt;TrieNode&gt; *temp = (*cur)-&gt;<span class="built_in">GetChildNode</span>(key_char);</span><br><span class="line">cur = temp;</span><br></pre></td></tr></table></figure><p><strong>åˆ é™¤keyæ—¶</strong>æˆ‘ä¹Ÿé‡åˆ°ä¸€äº›å°é—®é¢˜ã€‚å°±ä¸Šå›¾è€Œè¨€ï¼Œå¦‚æœæƒ³è¦åˆ é™¤(â€œbcâ€,3)ï¼Œé‚£ä¹ˆæŠŠ(c-&gt;3)è¿™ä¸ªTrieNodeWithValueè½¬æ¢ä¸ºTrieNodeå³å¯ã€‚å¦‚æœæƒ³è¦åˆ é™¤(â€œbefâ€,5)ï¼Œå°±éœ€è¦æŠŠä»(e)å¼€å§‹ åŒ…æ‹¬è‡ªå·±åŠä»¥ä¸‹çš„æ‰€æœ‰èŠ‚ç‚¹ç”¨é€’å½’çš„æ–¹å¼åˆ é™¤ã€‚</p><p>å¦‚ä½•åˆ¤æ–­åˆ é™¤æ—¶åº”è¯¥è½¬æ¢è¿˜æ˜¯é€’å½’åˆ é™¤ï¼Ÿçœ‹å¾…åˆ é™¤keyçš„ä¸‹é¢è¿˜æœ‰æ²¡æœ‰è·¯ã€‚æ¯”å¦‚â€bcâ€ä¸‹é¢è¿˜æœ‰(d-&gt;4)ï¼Œæœ‰è·¯ï¼Œè½¬æ¢ï¼›â€befâ€ä¸‹é¢æ²¡æœ‰è·¯ï¼Œé€’å½’åˆ é™¤ã€‚</p><p>å¦‚ä½•é€’å½’åˆ é™¤ï¼Ÿå…ˆåˆ¤æ–­èµ·å§‹èŠ‚ç‚¹begin_nodeï¼Œèµ·å§‹èŠ‚ç‚¹å®šä¹‰ä¸ºéå†è¿‡ç¨‹ä¸­é‡åˆ°çš„å€’æ•°ç¬¬äºŒä¸ªTrieNodeWithValueï¼Œå¦‚æœä¸å­˜åœ¨å°±ä¸ºroot_ã€‚æ³¨æ„èµ·å§‹èŠ‚ç‚¹å¹¶ä¸ä»£è¡¨å°±è¦ä»è¿™é‡Œä¸€è·¯åˆ åˆ°åº•ï¼Œåªèƒ½è¯´æ˜åœ¨æ­¤ä¹‹ä¸Šæ²¡æœ‰éœ€è¦åˆ é™¤çš„èŠ‚ç‚¹ï¼Œä»è¿™é‡Œå¼€å§‹å¤„ç†ä¸ä¼šæ¼åˆ ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Destory</span>(begin_node, key, i);</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€’å½’åˆ é™¤æ•´æ£µæ ‘</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">Destory</span><span class="params">(std::unique_ptr&lt;TrieNode&gt; *cur, <span class="keyword">const</span> std::string &amp;key, <span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    std::__cxx11::basic_string&lt;<span class="keyword">char</span>&gt;::size_type pos = i;</span><br><span class="line">    <span class="keyword">bool</span> flag = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (pos &lt; key.<span class="built_in">size</span>() &amp;&amp; (*cur)-&gt;<span class="built_in">HasChild</span>(key[i])) &#123;</span><br><span class="line">      std::unique_ptr&lt;TrieNode&gt; *temp = (*cur)-&gt;<span class="built_in">GetChildNode</span>(key[i]);</span><br><span class="line">      flag = <span class="built_in">Destory</span>(temp, key, i + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!flag) &#123;</span><br><span class="line">      (*cur)-&gt;<span class="built_in">RemoveChildNode</span>(key[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (*cur)-&gt;<span class="built_in">HasChildren</span>();  <span class="comment">// å¦‚æœæœ‰åˆ†æ”¯ï¼Œå°±ä¸å†åˆ é™¤ä¸Šé¢çš„éƒ¨åˆ†</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="å¹¶å‘æ§åˆ¶"><a href="#å¹¶å‘æ§åˆ¶" class="headerlink" title="å¹¶å‘æ§åˆ¶"></a>å¹¶å‘æ§åˆ¶</h2><p>åœ¨Trieç±»ä¸­å®šä¹‰è¯»å†™é”ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ReaderWriterLatch latch_;</span><br></pre></td></tr></table></figure><p>å¯¹äºæ’å…¥å’Œåˆ é™¤ï¼Œä¸Šå†™é”ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">latch_.<span class="built_in">WLock</span>(); <span class="comment">// å‡½æ•°å¼€å§‹æ—¶å†™è¿™å¥</span></span><br><span class="line">latch_.<span class="built_in">WUnlock</span>(); <span class="comment">// å‡½æ•°returnå‰å†™è¿™å¥</span></span><br></pre></td></tr></table></figure><p>å¯¹äºæŸ¥æ‰¾åªéœ€è¦ä¸Šè¯»é”ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">latch_.<span class="built_in">RLock</span>();</span><br><span class="line">latch_.<span class="built_in">RUnlock</span>();</span><br></pre></td></tr></table></figure><hr><h2 id="è®°ä¸€äº›è¯­æ³•é”™è¯¯"><a href="#è®°ä¸€äº›è¯­æ³•é”™è¯¯" class="headerlink" title="è®°ä¸€äº›è¯­æ³•é”™è¯¯"></a>è®°ä¸€äº›è¯­æ³•é”™è¯¯</h2><p>æˆ‘å¯¹c++çš„ç§»åŠ¨è¯­ä¹‰å¤ªä¸ç†Ÿæ‚‰äº†ï¼Œå¼€å§‹è¿ç¼–è¯‘éƒ½éš¾è¿‡ğŸ˜¢ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">TrieNode</span>(TrieNode &amp;&amp;other_trie_node) <span class="keyword">noexcept</span> &#123; <span class="comment">// noexcept:å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œå‡½æ•°ä¸­ä¸ä¼šå‘ç”Ÿå¼‚å¸¸</span></span><br><span class="line">    is_end_=other_trie_node.is_end_;</span><br><span class="line">    key_char_=other_trie_node.key_char_;</span><br><span class="line">    <span class="comment">// children_=other_trie_node.children_;âŒ children_çš„ç±»å‹åµŒå¥—äº†std::unique_ptr&lt;T&gt;ï¼Œéœ€è¦ä½¿ç”¨ç§»åŠ¨è¯­ä¹‰</span></span><br><span class="line">    children_=std::<span class="built_in">move</span>(other_trie_node.children_);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// insertæ—¶åˆ°è¾¾æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¦æŠŠTrieNodeè½¬æ¢æˆTrieNodeWithValue</span></span><br><span class="line"><span class="keyword">auto</span> new_node_ptr = <span class="keyword">new</span> TrieNodeWithValue&lt;T&gt;(std::<span class="built_in">move</span>(**cur), value);</span><br><span class="line">(*cur).<span class="built_in">reset</span>(new_node_ptr); <span class="comment">// é‡Šæ”¾curæŒ‡å‘çš„èµ„æºå¯¹è±¡ï¼ŒåŒæ—¶æŒ‡å‘æ–°çš„å¯¹è±¡ï¼Œç”¨reset()</span></span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//TrieNodeWithValue(TrieNode &amp;&amp;trieNode, T value):TrieNode(trieNode) &#123;âŒéœ€è¦ä½¿ç”¨std::forward&lt;TrieNode&gt;è½¬å‘å³å€¼å¼•ç”¨</span></span><br><span class="line"><span class="built_in">TrieNodeWithValue</span>(TrieNode &amp;&amp;trieNode, T value):<span class="built_in">TrieNode</span>(std::forward&lt;TrieNode&gt;(trieNode)) &#123;</span><br><span class="line">    <span class="built_in">SetEndNode</span>(<span class="literal">true</span>);</span><br><span class="line">    value_=value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TrieNode *last_node = (*cur).<span class="built_in">get</span>();  <span class="comment">// get()æ–¹æ³•è¿”å›è£¸æŒ‡é’ˆ,ä¸èƒ½ç”¨release() </span></span><br></pre></td></tr></table></figure><hr><h2 id="ğŸ‰"><a href="#ğŸ‰" class="headerlink" title="ğŸ‰"></a>ğŸ‰</h2><img src="https://s2.loli.net/2023/05/05/NIc3LoFU2A54vtX.png" alt="å…¨éƒ¨é€šè¿‡ï¼" style="zoom: 50%;" />]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;åªè®°å½•è‡ªå·±åœ¨å®ç°è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ï¼Œæ‰€ä»¥å†™å¾—ä¸å¤Ÿè¯¦å°½ï¼ˆå½“ç„¶ä¹Ÿä¸ä¼šå…¬å¼€å®Œæ•´ä»£ç &lt;/p&gt;
&lt;p&gt;ç”¨æ—¶ä¸¤ä¸ªæœˆç´§èµ¶æ…¢èµ¶åœ°ç»ˆäºåšå®Œäº†p3ã€‚æœ¬æ¥æ˜¯æ‰“ç®—ç­‰å…¨éƒ¨åšå®Œå†å¼€å§‹å†™åšå®¢çš„ï¼Œä½†æ˜¯æˆ‘çªç„¶æœ‰äº†ä¸€ç§å¾ˆç´¯æƒ³æ­‡æ­‡çš„æ„Ÿè§‰ï¼Œæ‰€ä»¥å¹²è„†å…ˆå†™å†™åšå®¢ã€è§£å†³ä¸‹ä¹‹å‰é—ç•™çš„é—®é¢˜ï¼Œä¼‘æ¯ä¸€é˜µå­å†ç ”ç©¶p4å§ã€‚&lt;/p&gt;
</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Claire&#39;s Art Show</title>
    <link href="http://example.com/2022/02/10/art/"/>
    <id>http://example.com/2022/02/10/art/</id>
    <published>2022-02-10T09:02:30.901Z</published>
    <updated>2023-05-12T13:12:57.833Z</updated>
    
    <content type="html"><![CDATA[<p>2021/12/13</p><img src="https://s2.loli.net/2022/01/21/EDl5TA94tbHnOvd.jpg" style="zoom:50%;" /><p>2022/01/28</p><img src="https://s2.loli.net/2022/02/10/wRh6UrIaTQ4ZFzt.jpg" style="zoom: 25%;" /><p>2022/02/07</p><img src="https://s2.loli.net/2022/02/10/D1fdQh2sCKjWIO7.jpg" style="zoom:25%;" /><p>2023/05/12</p><img src="https://s2.loli.net/2023/05/12/O9Bk8EDChZMXyoA.jpg" style="zoom:25%;" />]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;2021/12/13&lt;/p&gt;
&lt;img src=&quot;https://s2.loli.net/2022/01/21/EDl5TA94tbHnOvd.jpg&quot; style=&quot;zoom:50%;&quot; /&gt;

&lt;p&gt;2022/01/28&lt;/p&gt;
&lt;img src=&quot;https://s2</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>learn to use typora</title>
    <link href="http://example.com/2022/01/17/learn%20to%20use%20typora/"/>
    <id>http://example.com/2022/01/17/learn%20to%20use%20typora/</id>
    <published>2022-01-17T11:55:34.810Z</published>
    <updated>2023-05-04T09:31:48.949Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1-æ ‡é¢˜"><a href="#1-æ ‡é¢˜" class="headerlink" title="1.æ ‡é¢˜"></a>1.æ ‡é¢˜</h3><p>Ctrl+n :  nçº§æ ‡é¢˜</p><h1 id="æ ‡é¢˜1"><a href="#æ ‡é¢˜1" class="headerlink" title="æ ‡é¢˜1"></a>æ ‡é¢˜1</h1><h2 id="æ ‡é¢˜2"><a href="#æ ‡é¢˜2" class="headerlink" title="æ ‡é¢˜2"></a>æ ‡é¢˜2</h2><h3 id="æ ‡é¢˜3"><a href="#æ ‡é¢˜3" class="headerlink" title="æ ‡é¢˜3"></a>æ ‡é¢˜3</h3><h4 id="æ ‡é¢˜4"><a href="#æ ‡é¢˜4" class="headerlink" title="æ ‡é¢˜4"></a>æ ‡é¢˜4</h4><h5 id="æ ‡é¢˜5"><a href="#æ ‡é¢˜5" class="headerlink" title="æ ‡é¢˜5"></a>æ ‡é¢˜5</h5><h6 id="æ ‡é¢˜6"><a href="#æ ‡é¢˜6" class="headerlink" title="æ ‡é¢˜6"></a>æ ‡é¢˜6</h6><p>æ­£æ–‡</p><h3 id="2-å¼•ç”¨"><a href="#2-å¼•ç”¨" class="headerlink" title="2.å¼•ç”¨"></a>2.å¼•ç”¨</h3><p>å¼•ç”¨ :  &gt; + ç©ºæ ¼</p><p>é€€å‡ºå¼•ç”¨ :  Shift + Tab</p><p>è§’æ ‡ :  </p><p>æ–¹æ‹¬å·é‡Œæ‹¬^å’Œæ•°å­—</p><p>è§’æ ‡<a href="%E5%87%BA%E8%87%AA%C2%B7%C2%B7%C2%B7%C2%B7%C2%B7%C2%B7">^1</a></p><blockquote><p>å¼•ç”¨</p></blockquote><h3 id="3-åˆ—è¡¨"><a href="#3-åˆ—è¡¨" class="headerlink" title="3.åˆ—è¡¨"></a>3.åˆ—è¡¨</h3><p>æ— åºåˆ—è¡¨ :  Ctrl + Shift + ]</p><p>å­åˆ—è¡¨ :  Tab</p><p>å›é€€ :  Shift + Tab</p><ul><li>åˆ—è¡¨</li><li>åˆ—è¡¨<ul><li>å­åˆ—è¡¨<ul><li>å­åˆ—è¡¨again</li></ul></li><li>å›é€€åˆ°ä¸Šä¸€ä¸ªå­åˆ—è¡¨</li></ul></li><li>å†å›é€€</li></ul><p>æœ‰åºåˆ—è¡¨ :  Ctrl + Shift +[</p><ol><li>åˆ—è¡¨</li><li>åˆ—è¡¨<ol><li>å­åˆ—è¡¨</li></ol></li></ol><h3 id="4-é“¾æ¥"><a href="#4-é“¾æ¥" class="headerlink" title="4.é“¾æ¥"></a>4.é“¾æ¥</h3><p>[é“¾æ¥åç§°] + (åœ°å€)</p><p><a href="www.baidu.com">ç™¾åº¦</a></p><h3 id="5-å›¾åƒ"><a href="#5-å›¾åƒ" class="headerlink" title="5.å›¾åƒ"></a>5.å›¾åƒ</h3><p><img src="https://s2.loli.net/2022/01/17/xb8MypS2BOLKavU.jpg"></p><h3 id="6-åˆ’é‡ç‚¹"><a href="#6-åˆ’é‡ç‚¹" class="headerlink" title="6.åˆ’é‡ç‚¹"></a>6.åˆ’é‡ç‚¹</h3><p>é«˜äº® :   <img src="https://s2.loli.net/2022/01/17/IiqoHKBjLxzGdwb.png"></p><p>==é«˜äº®==</p><p>åŠ ç²— ï¼šCtrl + B</p><p><strong>åŠ ç²—</strong></p><p>ä¸¤ä¸ª*ä¸­é—´å¤¹æ–œä½“</p><p><em>æ–œä½“</em></p><h3 id="7-è¡¨æ ¼"><a href="#7-è¡¨æ ¼" class="headerlink" title="7.è¡¨æ ¼"></a>7.è¡¨æ ¼</h3><p>æ’å…¥è¡¨æ ¼ ï¼šCtrl + T</p><table><thead><tr><th>chen</th><th></th><th></th></tr></thead><tbody><tr><td>zhang</td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr></tbody></table><h3 id="8-ä»£ç å—"><a href="#8-ä»£ç å—" class="headerlink" title="8.ä»£ç å—"></a>8.ä»£ç å—</h3><p>è¾“å…¥3ä¸ª*å¹¶æŒ‰å›è½¦</p><hr><p>int c=1;</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;1-æ ‡é¢˜&quot;&gt;&lt;a href=&quot;#1-æ ‡é¢˜&quot; class=&quot;headerlink&quot; title=&quot;1.æ ‡é¢˜&quot;&gt;&lt;/a&gt;1.æ ‡é¢˜&lt;/h3&gt;&lt;p&gt;Ctrl+n :  nçº§æ ‡é¢˜&lt;/p&gt;
&lt;h1 id=&quot;æ ‡é¢˜1&quot;&gt;&lt;a href=&quot;#æ ‡é¢˜1&quot; class=&quot;headerli</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="http://example.com/2021/11/23/hello-world/"/>
    <id>http://example.com/2021/11/23/hello-world/</id>
    <published>2021-11-23T00:27:48.068Z</published>
    <updated>2021-11-23T00:27:48.068Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.io/docs/&quot;&gt;documentation&lt;/a&gt; for</summary>
      
    
    
    
    
  </entry>
  
</feed>
